Param(
    [parameter(mandatory=$true)][String]$plainTextPassword,
    [parameter(mandatory=$true)][String]$domain
)

# Create Secure Password
$password = ConvertTo-SecureString -String $plainTextPassword -AsPlainText -Force

function Disable-InternetExplorerESC {
    $AdminKey = "HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A7-37EF-4b3f-8CFC-4F3A74704073}"
    $UserKey = "HKLM:\SOFTWARE\Microsoft\Active Setup\Installed Components\{A509B1A8-37EF-4b3f-8CFC-4F3A74704073}"
    Set-ItemProperty -Path $AdminKey -Name "IsInstalled" -Value 0 -Force
    Set-ItemProperty -Path $UserKey -Name "IsInstalled" -Value 0 -Force
    Stop-Process -Name Explorer -Force
    Write-Host "IE Enhanced Security Configuration (ESC) has been disabled." -ForegroundColor Green
}

# Disable IE ESC
Disable-InternetExplorerESC

# Add AD DS Role
Install-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools

# Other Settings
# Set-WinHomeLocation -GeoId 0x7A
# Set-WinSystemLocale -SystemLocale ja-JP
Set-TimeZone -Id "Tokyo Standard Time"

# Install New Forest
Install-ADDSForest -DomainName $domain -InstallDNS -SafeModeAdministratorPassword $password -Force